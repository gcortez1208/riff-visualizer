<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Riff Visualizer - From Womb to Waste</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: 'Courier New', Courier, monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      margin-bottom: 20px;
    }

    .fretboard {
      display: grid;
      grid-template-columns: repeat(16, 40px);
      gap: 2px;
    }

    .fret {
      width: 40px;
      height: 30px;
      background: #333;
      border: 1px solid #555;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .active {
      background: lime;
      color: black;
      font-weight: bold;
    }

    button, select {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      background: #444;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover, select:hover {
      background: #666;
    }
  </style>
</head>
<body>
  <h1>Guitar Riff Visualizer (Drop C)</h1>
  <div class="fretboard" id="fretboard"></div>
  <select id="riffSelector">
    <option value="womb">From Womb to Waste - Intro</option>
    <option value="custom1">Brutal Custom Riff</option>
    <option value="custom2">Groove Slayer Riff</option>
  </select>
  <button onclick="startRiff()">Play Riff</button>
  <button onclick="toggleLoop()">Loop</button>

  <script>
    const strings = 6;
    const frets = 16;
    const fretboard = document.getElementById("fretboard");

    for (let s = 0; s < strings; s++) {
      for (let f = 0; f < frets; f++) {
        const fret = document.createElement("div");
        fret.classList.add("fret");
        fret.dataset.string = s;
        fret.dataset.fret = f;
        fret.textContent = f;
        fretboard.appendChild(fret);
      }
    }

    const riffs = {
      womb: [
        [0, 2, 0], [0, 3, 300], [1, 2, 600], [1, 3, 900],
        [0, 5, 1200], [1, 3, 1500], [0, 4, 1800], [1, 2, 2100],
        [0, 5, 2400], [1, 3, 2700], [0, 8, 3000], [1, 6, 3300],
        [0, 7, 3600], [1, 5, 3900], [0, 5, 4200], [1, 3, 4500],
        [0, 7, 4800], [1, 5, 5100], [0, 5, 5400], [1, 3, 5700],
        [0, 4, 6000], [1, 2, 6300], [0, 5, 6600], [1, 3, 6900],
        [0, 8, 7200], [1, 6, 7500], [0, 7, 7800], [1, 5, 8100],
        [0, 5, 8400], [1, 3, 8700], [0, 7, 9000], [1, 5, 9300]
      ],
      custom1: [
        [0, 5, 0], [1, 7, 400], [2, 5, 800], [1, 6, 1200],
        [0, 4, 1600], [0, 5, 2000], [1, 7, 2400]
      ],
      custom2: [
        [0, 3, 0], [0, 6, 350], [1, 3, 700], [2, 6, 1050],
        [3, 5, 1400], [1, 3, 1700], [0, 0, 2000]
      ]
    };

    const context = new (window.AudioContext || window.webkitAudioContext)();
    const noteAudio = new Audio("https://freesound.org/data/previews/331/331912_3248244-lq.mp3");

    let isLooping = false;
    let playTimeouts = [];

    function playSample(fret) {
      const audio = noteAudio.cloneNode();
      audio.playbackRate = 1 + fret * 0.03;
      audio.play();
    }

    function playRiff(riff) {
      stopRiff();
      riff.forEach(([string, fret, delay]) => {
        const timeout = setTimeout(() => {
          const selector = `.fret[data-string="${string}"][data-fret="${fret}"]`;
          const el = document.querySelector(selector);
          el.classList.add("active");
          playSample(fret);
          setTimeout(() => el.classList.remove("active"), 200);
        }, delay);
        playTimeouts.push(timeout);
      });
    }

    function stopRiff() {
      playTimeouts.forEach(clearTimeout);
      playTimeouts = [];
    }

    function startRiff() {
      const selected = document.getElementById("riffSelector").value;
      playRiff(riffs[selected]);
    }

    function toggleLoop() {
      isLooping = !isLooping;
      const selected = document.getElementById("riffSelector").value;
      const riff = riffs[selected];
      if (isLooping) {
        function loop() {
          playRiff(riff);
          if (isLooping) setTimeout(loop, riff[riff.length - 1][2] + 500);
        }
        loop();
      } else {
        stopRiff();
      }
    }
  </script>
</body>
</html>
